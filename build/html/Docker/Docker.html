<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>容器简介 &mdash; Liu圈圈的后宫 1.0.0 文档</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/translations.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="DevOps落地笔记" href="../DevOps%E8%90%BD%E5%9C%B0%E7%AC%94%E8%AE%B0/index.html" />
    <link rel="prev" title="Docker" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Liu圈圈的后宫
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">内容索引:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95%E4%BD%93%E7%B3%BB%E7%9F%A5%E8%AF%86/index.html">软件测试体系知识</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Python%E7%AC%94%E8%AE%B0/index.html">Python笔记</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Linux%E7%AC%94%E8%AE%B0/index.html">Linux笔记</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/index.html">计算机网络</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Web%E5%AE%89%E5%85%A8/index.html">Web安全</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E6%95%B0%E6%8D%AE%E5%BA%93/index.html">数据库</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E5%BE%AE%E6%9C%8D%E5%8A%A1/index.html">微服务</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E5%89%8D%E7%AB%AF%E6%B8%B8%E4%B9%90%E5%9C%BA/index.html">前端游乐场</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E5%90%8E%E7%AB%AF%E8%AE%AD%E7%BB%83%E5%9C%BA/index.html">后端训练场</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E5%85%B7/index.html">自动化工具</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Docker</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">容器简介</a></li>
<li class="toctree-l2"><a class="reference internal" href="#docker">什么是 Docker？</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">安装Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">docker镜像相关操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id4">容器的日常管理</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id5">Docker 数据卷的管理</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dockerfiledocker">Dockerfile自动构建docker镜像</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id6">Docker中的镜像分层</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dockerzabbix-server">使用docker运行zabbix-server</a></li>
<li class="toctree-l2"><a class="reference internal" href="#docker-registry">docker 仓库（registry）</a></li>
<li class="toctree-l2"><a class="reference internal" href="#docker-compose">docker-compose编排工具</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id7">重启docker服务，容器全部退出的解决办法</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id8">Docker网络类型</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dockerharbor">docker企业级镜像仓库harbor</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id9">使用容器的建议</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id10">关于Docker容器的监控</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../DevOps%E8%90%BD%E5%9C%B0%E7%AC%94%E8%AE%B0/index.html">DevOps落地笔记</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E5%BC%80%E6%BA%90%E5%89%8D%E5%93%A8/index.html">开源前哨</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E7%9C%BC%E5%89%8D%E4%B8%80%E4%BA%AE%E7%9A%84%E9%93%BE%E6%8E%A5%E5%A4%87%E5%BF%98%E5%BD%95/index.html">眼前一亮的链接备忘录</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E4%BC%9A%E5%B8%A6%E5%9B%A2%E9%98%9F%E7%9A%84%E6%8A%80%E6%9C%AF%E4%BA%BA/index.html">会带团队的技术人</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E6%96%87%E6%A1%A3%E9%9B%86/index.html">文档集</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/index.html">环境搭建</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E5%9C%88%E5%9C%88%E7%A2%8E%E7%A2%8E%E5%BF%B5/index.html">圈圈碎碎念</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Liu圈圈的后宫</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Docker</a> &raquo;</li>
      <li>容器简介</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/Docker/Docker.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="id1">
<h1>容器简介<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h1>
<ol class="simple">
<li><p>什么是 Linux 容器</p>
<ul class="simple">
<li><p>Linux容器是与系统其他部分隔离开的一系列进程，从另一个镜像运行，并由该镜像提供支持进程所需的全部文件。容器提供的镜像包含了应用的所有依赖项，因而在从开发到测试再到生产的整个过程中，它都具有可移植性和一致性。</p></li>
<li><p>更加详细地来说，请您假定您在开发一个应用。您使用的是一台笔记本电脑，而且您的开发环境具有特定的配置。其他开发人员身处的环境配置可能稍有不同。您正在开发的应用依赖于您当前的配置，还要依赖于某些特定文件。与此同时，您的企业还拥有标准化的测试和生产环境，且具有自身的配置和一系列支持文件。您希望尽可能多在本地模拟这些环境，而不产生重新创建服务器环境的开销。</p></li>
<li><p>因此，您要如何确保应用能够在这些环境中运行和通过质量检测，并且在部署过程中不出现令人头疼的问题，也无需重新编写代码和进行故障修复？答案就是使用容器。容器可以确保您的应用拥有必需的配置和文件，使得这些应用能够在从开发到测试、再到生产的整个流程中顺利运行，而不出现任何不良问题。这样可以避免危机，做到皆大欢喜。</p></li>
<li><p>虽然这只是简化的示例，但在需要很高的可移植性、可配置性和隔离的情况下，我们可以利用 Linux 容器通过很多方式解决难题。无论基础架构是在企业内部还是在云端，或者混合使用两者，容器都能满足您的需求。</p></li>
</ul>
</li>
<li><p>容器不就是虚拟化吗</p>
<ul class="simple">
<li><p>是，但也不竟然。我们用一种简单方式来思考一下：</p></li>
<li><p>虚拟化使得许多操作系统可同时在单个系统上运行。</p></li>
<li><p>容器则可共享同一个操作系统内核，将应用进程与系统其他部分隔离开。</p></li>
<li><p>图-普通虚拟化技术和Docker的对比</p></li>
<li><p>这意味着什么？首先，让多个操作系统在单个虚拟机监控程序上运行以实现虚拟化，并不能达成和使用容器同等的轻量级效果。事实上，在仅拥有容量有限的有限资源时，您需要能够可以进行密集部署的轻量级应用。Linux 容器可从单个操作系统运行，在所有容器中共享该操作系统，因此应用和服务能够保持轻量级，并行快速运行。</p></li>
</ul>
</li>
<li><p>容器发展简史</p>
<ul class="simple">
<li><p>我们现在称为容器技术的概念最初出现在 2000 年，当时称为 FreeBSD jail，这种技术可将 FreeBSD 系统分区为多个子系统（也称为 Jail）。Jail 是作为安全环境而开发的，系统管理员可与企业内部或外部的多个用户共享这些 Jail。</p></li>
<li><p>Jail 的目的是让进程在经过修改的 chroot 环境中创建，而不会脱离和影响整个系统 — 在 chroot 环境中，对文件系统、网络和用户的访问都实现了虚拟化。尽管 Jail 在实施方面存在局限性，但最终人们找到了脱离这种隔离环境的方法。</p></li>
<li><p>但这个概念非常有吸引力。</p></li>
<li><p>2001 年，通过 Jacques Gélinas 的 VServer 项目，隔离环境的实施进入了 Linux 领域。正如 Gélinas 所说，这项工作的目的是“在高度独立且安全的单一环境中运行多个通用 Linux 服务器 [sic]。” 在完成了这项针对 Linux 中多个受控制用户空间的基础性工作后，Linux 容器开始逐渐成形并最终发展成了现在的模样。</p></li>
</ul>
</li>
</ol>
</section>
<section id="docker">
<h1>什么是 Docker？<a class="headerlink" href="#docker" title="永久链接至标题">¶</a></h1>
<ul class="simple">
<li><p>“Docker” 一词指代多种事物，包括开源社区项目、开源项目使用的工具、主导支持此类项目的公司 Docker Inc. 以及该公司官方支持的工具。技术产品和公司使用同一名称，的确让人有点困惑。</p></li>
<li><p>IT 软件中所说的 “Docker” ，是指容器化技术，用于支持创建和使用 Linux 容器。</p></li>
<li><p>开源 Docker 社区致力于改进这类技术，并免费提供给所有用户，使之获益。</p></li>
<li><p>Docker Inc. 公司凭借 Docker 社区产品起家，它主要负责提升社区版本的安全性，并将改进后的版本与更广泛的技术社区分享。此外，它还专门对这些技术产品进行完善和安全固化，以服务于企业客户。</p></li>
<li><p>借助 Docker ，您可将容器当做重量轻、模块化的虚拟机使用。同时，您还将获得高度的灵活性，从而实现对容器的高效创建、部署及复制，并能将其从一个环境顺利迁移至另一个环境。</p></li>
</ul>
<ol class="simple">
<li><p>Docker 如何工作？</p>
<ul class="simple">
<li><p>Docker 技术使用 Linux 内核和内核功能（例如 Cgroups 和 namespaces）来分隔进程，以便各进程相互独立运行。这种独立性正是采用容器的目的所在；它可以独立运行多种进程、多个应用程序，更加充分地发挥基础设施的作用，同时保持各个独立系统的安全性。</p></li>
<li><p>容器工具（包括 Docker）可提供基于镜像的部署模式。这使得它能够轻松跨多种环境，与其依赖程序共享应用或服务组。Docker 还可在这一容器环境中自动部署应用程序（或者合并多种流程，以构建单个应用程序）。</p></li>
<li><p>此外，由于这些工具基于 Linux 容器构建，使得 Docker 既易于使用，又别具一格 —— 它可为用户提供前所未有的高度应用程访问权限、快速部署以及版本控制和分发能力。</p></li>
</ul>
</li>
<li><p>Docker 技术是否与传统的 Linux 容器相同？</p>
<ul class="simple">
<li><p>否。Docker 技术最初是基于 LXC 技术构建（大多数人都会将这一技术与“传统的” Linux 容器联系在一起），但后来它逐渐摆脱了对这种技术的依赖。</p></li>
<li><p>就轻量级虚拟化这一功能来看，LXC 非常有用，但它无法提供出色的开发人员或用户体验。除了运行容器之外，Docker 技术还具备其他多项功能，包括简化用于构建容器、传输镜像以及控制镜像版本的流程。</p></li>
<li><p>传统的 Linux 容器使用 init 系统来管理多种进程。这意味着，所有应用程序都作为一个整体运行。与此相反，Docker 技术鼓励应用程序各自独立运行其进程，并提供相应工具以实现这一功能。这种精细化运作模式自有其优势。</p></li>
</ul>
</li>
<li><p>docker的目标</p>
<ul class="simple">
<li><p>docker的主要目标是”Build,Ship and Run any App,Angwhere”,构建，运输，处处运行</p></li>
<li><p>构建：做一个docker镜像</p></li>
<li><p>运输：docker pull</p></li>
<li><p>运行：启动一个容器</p></li>
<li><p>每一个容器，他都有自己的文件系统rootfs.</p></li>
</ul>
</li>
</ol>
</section>
<section id="id2">
<h1>安装Docker<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h1>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 需要两台节点进行安装</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@docker01</span> <span class="o">~</span><span class="p">]</span><span class="c1"># cat /etc/redhat-release </span>
<span class="n">CentOS</span> <span class="n">Linux</span> <span class="n">release</span> <span class="mf">7.2</span><span class="o">.</span><span class="mi">1511</span> <span class="p">(</span><span class="n">Core</span><span class="p">)</span> 
<span class="p">[</span><span class="n">root</span><span class="nd">@docker01</span> <span class="o">~</span><span class="p">]</span><span class="c1"># uname  -r </span>
<span class="mf">3.10</span><span class="o">.</span><span class="mi">0</span><span class="o">-</span><span class="mf">327.</span><span class="n">el7</span><span class="o">.</span><span class="n">x86_64</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@docker01</span> <span class="o">~</span><span class="p">]</span><span class="c1"># hostname -I</span>
<span class="mf">10.0</span><span class="o">.</span><span class="mf">0.100172</span><span class="o">.</span><span class="mf">16.1</span><span class="o">.</span><span class="mi">100</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@docker02</span> <span class="o">~</span><span class="p">]</span><span class="c1"># hostname -I</span>
<span class="mf">10.0</span><span class="o">.</span><span class="mf">0.101172</span><span class="o">.</span><span class="mf">16.1</span><span class="o">.</span><span class="mi">101</span>
</pre></div>
</div>
<ul class="simple">
<li><p>在两个节点上都进行操作</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wget</span> <span class="o">-</span><span class="n">O</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">yum</span><span class="o">.</span><span class="n">repos</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">.</span><span class="n">repo</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">mirrors</span><span class="o">.</span><span class="n">ustc</span><span class="o">.</span><span class="n">edu</span><span class="o">.</span><span class="n">cn</span><span class="o">/</span><span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">/</span><span class="n">linux</span><span class="o">/</span><span class="n">centos</span><span class="o">/</span><span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">.</span><span class="n">repo</span>
<span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s1">&#39;s#download.docker.com#mirrors.ustc.edu.cn/docker-ce#g&#39;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">yum</span><span class="o">.</span><span class="n">repos</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">.</span><span class="n">repo</span>
<span class="n">yum</span> <span class="n">install</span> <span class="n">docker</span><span class="o">-</span><span class="n">ce</span> <span class="o">-</span><span class="n">y</span>
</pre></div>
</div>
<ul class="simple">
<li><p>修改在docker01配置：</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 修改启动文件，监听远程端口</span>
<span class="n">vim</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">systemd</span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">docker</span><span class="o">.</span><span class="n">service</span>
<span class="n">ExecStart</span>\<span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">dockerd</span> <span class="o">-</span><span class="n">H</span> <span class="n">unix</span><span class="p">:</span><span class="o">///</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">docker</span><span class="o">.</span><span class="n">sock</span> <span class="o">-</span><span class="n">H</span> <span class="n">tcp</span><span class="p">:</span><span class="o">//</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.100</span><span class="p">:</span><span class="mi">2375</span> 
<span class="n">systemctl</span> <span class="n">daemon</span>\<span class="o">-</span><span class="n">reload</span>
<span class="n">systemctl</span> <span class="n">enable</span> <span class="n">docker</span><span class="o">.</span><span class="n">service</span> 
<span class="n">systemctl</span> <span class="n">restart</span> <span class="n">docker</span><span class="o">.</span><span class="n">service</span> 
<span class="c1"># ps -ef检查进行，是否启动</span>
</pre></div>
</div>
<ul class="simple">
<li><p>在docker02测试</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[root@docker02 ~]# docker -H 10.0.0.100 info
Containers: 0
 Running: 0
 Paused: 0
 Stopped: 0
Images: 0
Server Version: 17.12.0-ce
Storage Driver: devicemapper
···
</pre></div>
</div>
<ol>
<li><p>Docker基础命令操作</p>
<ul class="simple">
<li><p>查看docker相关信息</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@docker01</span> <span class="o">~</span><span class="p">]</span><span class="c1">#  docker version  </span>
<span class="n">Client</span><span class="p">:</span>
 <span class="n">Version</span><span class="p">:</span>    <span class="mf">17.12</span><span class="o">.</span><span class="mi">0</span><span class="o">-</span><span class="n">ce</span>
 <span class="n">API</span> <span class="n">version</span><span class="p">:</span>    <span class="mf">1.35</span>
 <span class="n">Go</span> <span class="n">version</span><span class="p">:</span>    <span class="n">go1</span><span class="o">.</span><span class="mf">9.2</span>
 <span class="n">Git</span> <span class="n">commit</span><span class="p">:</span>    <span class="n">c97c6d6</span>
 <span class="n">Built</span><span class="p">:</span>    <span class="n">Wed</span> <span class="n">Dec</span> <span class="mi">2720</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">142017</span>
 <span class="n">OS</span><span class="o">/</span><span class="n">Arch</span><span class="p">:</span>    <span class="n">linux</span><span class="o">/</span><span class="n">amd64</span>
<span class="n">Server</span><span class="p">:</span>
 <span class="n">Engine</span><span class="p">:</span>
  <span class="n">Version</span><span class="p">:</span>    <span class="mf">17.12</span><span class="o">.</span><span class="mi">0</span><span class="o">-</span><span class="n">ce</span>
  <span class="n">API</span> <span class="n">version</span><span class="p">:</span>    <span class="mf">1.35</span> <span class="p">(</span><span class="n">minimum</span> <span class="n">version</span> <span class="mf">1.12</span><span class="p">)</span>
  <span class="n">Go</span> <span class="n">version</span><span class="p">:</span>    <span class="n">go1</span><span class="o">.</span><span class="mf">9.2</span>
  <span class="n">Git</span> <span class="n">commit</span><span class="p">:</span>    <span class="n">c97c6d6</span>
  <span class="n">Built</span><span class="p">:</span>    <span class="n">Wed</span> <span class="n">Dec</span> <span class="mi">2720</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">462017</span>
  <span class="n">OS</span><span class="o">/</span><span class="n">Arch</span><span class="p">:</span>    <span class="n">linux</span><span class="o">/</span><span class="n">amd64</span>
  <span class="n">Experimental</span><span class="p">:</span>    <span class="n">false</span>
</pre></div>
</div>
<ul class="simple">
<li><p>配置docker镜像加速</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vi</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="n">daemon</span><span class="o">.</span><span class="n">json</span>
<span class="p">{</span> <span class="s2">&quot;registry-mirrors&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;https://registry.docker-cn.com&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>启动第一个容器</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@docker01</span> <span class="o">~</span><span class="p">]</span><span class="c1"># docker run -d -p 80:80 nginx</span>
<span class="n">Unable</span> <span class="n">to</span> <span class="n">find</span> <span class="n">image</span> <span class="s1">&#39;nginx:latest&#39;</span> <span class="n">locally</span>
<span class="n">latest</span><span class="p">:</span> <span class="n">Pulling</span> <span class="kn">from</span> <span class="nn">library</span><span class="o">/</span><span class="n">nginx</span>
<span class="n">e7bb522d92ff</span><span class="p">:</span> <span class="n">Pull</span> <span class="n">complete</span> 
<span class="mi">6</span><span class="n">edc05228666</span><span class="p">:</span> <span class="n">Pull</span> <span class="n">complete</span> 
<span class="n">cd866a17e81f</span><span class="p">:</span> <span class="n">Pull</span> <span class="n">complete</span> 
<span class="n">Digest</span><span class="p">:</span> <span class="n">sha256</span><span class="p">:</span><span class="mi">285</span><span class="n">b49d42c703fdf257d1e2422765c4ba9d3e37768d6ea83d7fe2043dad6e63d</span>
<span class="n">Status</span><span class="p">:</span> <span class="n">Downloaded</span> <span class="n">newer</span> <span class="n">image</span> <span class="k">for</span> <span class="n">nginx</span><span class="p">:</span><span class="n">latest</span>
<span class="mi">8</span><span class="n">d8f81da12b5c10af6ba1a5d07f4abc041cb95b01f3d632c3d638922800b0b4d</span> 
<span class="c1"># 容器启动后，在浏览器进行访问测试</span>
</pre></div>
</div>
</li>
<li><p>Docker镜像生命周期</p>
<ul class="simple">
<li><p>backlog!</p></li>
</ul>
</li>
</ol>
</section>
<section id="id3">
<h1>docker镜像相关操作<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h1>
<ol class="simple">
<li><p>搜索官方仓库镜像</p>
<ul class="simple">
<li><p>docker search centos</p></li>
</ul>
</li>
<li><p>获取镜像</p>
<ul class="simple">
<li><p>docker pull centos</p></li>
<li><p>查看当前主机镜像列表</p></li>
<li><p>docker image list</p></li>
<li><p>拉第三方镜像方法</p></li>
<li><p>docker pull index.tenxcloud.com/tenxcloud/httpd</p></li>
</ul>
</li>
<li><p>导出镜像</p>
<ul class="simple">
<li><p>docker image save centos &gt; docker-centos.tar.gz</p></li>
</ul>
</li>
<li><p>删除镜像</p>
<ul class="simple">
<li><p>docker image rm centos:latest</p></li>
</ul>
</li>
<li><p>导入镜像</p>
<ul class="simple">
<li><p>docker image load -i docker-centos.tar.gz</p></li>
</ul>
</li>
<li><p>查看镜像的详细信息</p>
<ul class="simple">
<li><p>docker image inspect centos</p></li>
</ul>
</li>
</ol>
</section>
<section id="id4">
<h1>容器的日常管理<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h1>
<ol>
<li><p>容器的起/停</p>
<ul class="simple">
<li><p>最简单的运行一个容器</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="n">nginx</span>
</pre></div>
</div>
<ul class="simple">
<li><p>创建容器，两步走（不常用）</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">create</span> <span class="n">centos</span><span class="p">:</span><span class="n">latest</span>  <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span>
<span class="n">docker</span> <span class="n">start</span> <span class="n">stupefied_nobel</span>
</pre></div>
</div>
<ul class="simple">
<li><p>快速启动容器方法</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span>  <span class="n">centos</span><span class="p">:</span><span class="n">latest</span>  <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sleep</span> <span class="mi">20</span>
<span class="c1">#容器内的第一个进程必须一直处于运行的状态，否则这个容器，就会处于退出状态！</span>
</pre></div>
</div>
<ul class="simple">
<li><p>查看正在运行的容器</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">container</span> <span class="n">ls</span>
<span class="n">docker</span> <span class="n">ps</span> 
</pre></div>
</div>
<ul class="simple">
<li><p>查看你容器详细信息/ip</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">container</span>  <span class="n">inspect</span>  <span class="n">容器名称</span><span class="o">/</span><span class="nb">id</span>
</pre></div>
</div>
<ul class="simple">
<li><p>查看你所有容器（包括未运行的)</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
<ul class="simple">
<li><p>停止容器</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">stop</span> <span class="n">容器名称</span><span class="o">/</span><span class="nb">id</span> 
<span class="n">docker</span> <span class="n">container</span>  <span class="n">kill</span>  <span class="n">容器名称</span><span class="o">/</span><span class="nb">id</span>
</pre></div>
</div>
</li>
<li><p>进入容器方法</p>
<ul class="simple">
<li><p>启动时进去方法</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">it</span> <span class="c1">#参数：-it 可交互终端</span>
<span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">it</span> <span class="n">nginx</span><span class="p">:</span><span class="n">latest</span>  <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span>
</pre></div>
</div>
<ul class="simple">
<li><p>退出/离开容器</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ctrl</span><span class="o">+</span><span class="n">p</span> <span class="o">&amp;</span> <span class="n">ctrl</span><span class="o">+</span><span class="n">q</span>
</pre></div>
</div>
<ul class="simple">
<li><p>启动后进入容器的方法</p></li>
<li><p>启动一个docker</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">it</span> <span class="n">centos</span><span class="p">:</span><span class="n">latest</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ps</span> <span class="o">-</span><span class="n">ef</span> 
<span class="n">UID</span>       <span class="n">PID</span>       <span class="n">PPID</span>  <span class="n">C</span> <span class="n">STIME</span> <span class="n">TTY</span>          <span class="n">TIME</span> <span class="n">CMD</span>
<span class="n">root</span>     <span class="mi">10015</span><span class="p">:</span><span class="mi">47</span>   <span class="n">pts</span><span class="o">/</span><span class="mi">000</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span>
<span class="n">root</span>     <span class="mi">131015</span><span class="p">:</span><span class="mi">47</span>  <span class="n">pts</span><span class="o">/</span><span class="mi">000</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="n">ps</span> <span class="o">-</span><span class="n">ef</span>
</pre></div>
</div>
<ul class="simple">
<li><p>attach进入容器，使用pts/0 ，会让所用通过此方法进如放入用户看到同样的操作。</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">attach</span> <span class="mi">1</span><span class="n">bf0f43c4d2f</span>
<span class="p">[</span><span class="n">root</span><span class="o">@</span><span class="mi">1</span><span class="n">bf0f43c4d2f</span> <span class="o">/</span><span class="p">]</span><span class="c1"># ps -ef </span>
<span class="n">UID</span>         <span class="n">PID</span>   <span class="n">PPID</span>  <span class="n">C</span> <span class="n">STIME</span> <span class="n">TTY</span>          <span class="n">TIME</span> <span class="n">CMD</span>
<span class="n">root</span>          <span class="mi">10015</span><span class="p">:</span><span class="mi">47</span> <span class="n">pts</span><span class="o">/</span><span class="mi">000</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span>
<span class="n">root</span>         <span class="mi">141015</span><span class="p">:</span><span class="mi">49</span> <span class="n">pts</span><span class="o">/</span><span class="mi">000</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="n">ps</span> <span class="o">-</span><span class="n">ef</span>
</pre></div>
</div>
<ul class="simple">
<li><p>自命名启动一个容器 –name</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">111</span>
</pre></div>
</div>
<ul class="simple">
<li><p>exec 进入容器方法（推荐使用）</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">exec</span> <span class="o">-</span><span class="n">it</span> <span class="n">clsn1</span>  <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span>
</pre></div>
</div>
</li>
<li><p>删除所有容器</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>docker rm -f  `docker ps -a -q`
# -f 强制删除
</pre></div>
</div>
</li>
<li><p>启动时进行端口映射</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">p参数端口映射</span>
<span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">p</span> <span class="mi">8888</span><span class="p">:</span><span class="mi">80</span>  <span class="n">nginx</span><span class="p">:</span><span class="n">latest</span> 
</pre></div>
</div>
<ul class="simple">
<li><p>不同指定映射方法参数说明</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>-p hostPort:containerPort    端口映射  -p 8080:80
-p ip:hostPort:containerPort 配置监听地址 -p 10.0.0.100:8080:80
-p ip::containerPort        随机分配端口 -p 10.0.0.100::80
-p hostPort:containerPort:udp 指定协议 -p 8080:80:tcp
-p 81:80 –p 443:443    指定多个
</pre></div>
</div>
<ul class="simple">
<li><p>随机映射</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>docker run -P （大P）# 需要镜像支持
</pre></div>
</div>
</li>
</ol>
</section>
<section id="id5">
<h1>Docker 数据卷的管理<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h1>
<ol>
<li><p>挂载时创建卷</p>
<ul class="simple">
<li><p>挂载卷</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">p</span> <span class="mi">80</span><span class="p">:</span><span class="mi">80</span> <span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="n">data</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">html</span> <span class="n">nginx</span><span class="p">:</span><span class="n">latest</span>
</pre></div>
</div>
<ul class="simple">
<li><p>容器内站点目录: /usr/share/nginx/html</p></li>
<li><p>在宿主机写入数据，查看</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s2">&quot;http://www.nmtui.com&quot;</span> <span class="o">&gt;/</span><span class="n">data</span><span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">html</span>
<span class="n">curl</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.100</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">nmtui</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
<ul class="simple">
<li><p>设置共享卷，使用同一个卷启动一个新的容器</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">p</span> <span class="mi">8080</span><span class="p">:</span><span class="mi">80</span> <span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="n">data</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">html</span> <span class="n">nginx</span><span class="p">:</span><span class="n">latest</span>
<span class="n">curl</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.100</span><span class="p">:</span><span class="mi">8080</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">nmtui</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
<ul class="simple">
<li><p>查看卷列表</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">volume</span> <span class="n">ls</span>
</pre></div>
</div>
</li>
<li><p>创建卷后挂载</p>
<ul class="simple">
<li><p>创建一个卷</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">volume</span> <span class="n">create</span>
<span class="n">docker</span> <span class="n">volume</span> <span class="n">ls</span> 
</pre></div>
</div>
<ul class="simple">
<li><p>指定卷名</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">111</span>
</pre></div>
</div>
<ul class="simple">
<li><p>查看卷路径</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">volume</span> <span class="n">inspect</span> <span class="n">clsn</span> 
<span class="p">[</span>
	<span class="p">{</span>
		<span class="s2">&quot;CreatedAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2018-02-01T00:39:25+08:00&quot;</span><span class="p">,</span>
		<span class="s2">&quot;Driver&quot;</span><span class="p">:</span> <span class="s2">&quot;local&quot;</span><span class="p">,</span>
		<span class="s2">&quot;Labels&quot;</span><span class="p">:</span> <span class="p">{},</span>
		<span class="s2">&quot;Mountpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;/var/lib/docker/volumes/clsn/_data&quot;</span><span class="p">,</span>
		<span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;clsn&quot;</span><span class="p">,</span>
		<span class="s2">&quot;Options&quot;</span><span class="p">:</span> <span class="p">{},</span>
		<span class="s2">&quot;Scope&quot;</span><span class="p">:</span> <span class="s2">&quot;local&quot;</span>
	<span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li><p>使用卷创建</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">p</span> <span class="mi">9000</span><span class="p">:</span><span class="mi">80</span> <span class="o">-</span><span class="n">v</span> <span class="n">clsn</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">html</span> <span class="n">nginx</span><span class="p">:</span><span class="n">latest</span> 
<span class="c1"># 宿主机测试</span>
<span class="n">echo</span> <span class="s1">&#39;blog.nmtui.com&#39;</span> <span class="o">&gt;/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="n">volumes</span><span class="o">/</span><span class="n">clsn</span><span class="o">/</span><span class="n">_data</span><span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">html</span>
<span class="n">curl</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.100</span><span class="p">:</span><span class="mi">9000</span>
</pre></div>
</div>
<ul class="simple">
<li><p>设置卷</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span>  <span class="o">-</span><span class="n">d</span>  <span class="o">-</span><span class="n">P</span>  <span class="o">--</span><span class="n">volumes</span><span class="o">-</span><span class="kn">from</span> <span class="mi">079786</span><span class="n">c1e297</span> <span class="n">nginx</span><span class="p">:</span><span class="n">latest</span>
</pre></div>
</div>
</li>
<li><p>手动将容器保存为镜像</p>
<ul class="simple">
<li><p>本次是基于docker官方centos 6.8 镜像创建</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">pull</span>  <span class="n">centos</span><span class="p">:</span><span class="mf">6.8</span>
<span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">it</span> <span class="o">-</span><span class="n">p</span> <span class="mi">1022</span><span class="p">:</span><span class="mi">22</span> <span class="n">centos</span><span class="p">:</span><span class="mf">6.8</span>  <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span>
<span class="c1"># 在容器种安装sshd服务，并修改系统密码</span>
<span class="n">yum</span> <span class="n">install</span>  <span class="n">openssh</span><span class="o">-</span><span class="n">server</span> <span class="o">-</span><span class="n">y</span> 
<span class="n">echo</span> <span class="s2">&quot;root:123456&quot;</span> <span class="o">|</span><span class="n">chpasswd</span>
<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">sshd</span> <span class="n">start</span>
</pre></div>
</div>
<ul class="simple">
<li><p>将容器提交为镜像
docker commit brave_mcclintock  centos6-ssh</p></li>
<li><p>使用新的镜像启动容器
docker run -d  -p 1122:22  centos6-ssh:latest  /usr/sbin/sshd -D</p></li>
<li><p>在容器安装httpd服务</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">yum</span> <span class="n">install</span> <span class="n">httpd</span> <span class="o">-</span><span class="n">y</span>
</pre></div>
</div>
<ul class="simple">
<li><p>编写启动脚本脚本</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="n">init</span><span class="o">.</span><span class="n">sh</span> 
	<span class="c1">#!/bin/bash </span>
	<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">httpd</span> <span class="n">start</span> 
	<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">sshd</span> <span class="o">-</span><span class="n">D</span>
<span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="n">init</span><span class="o">.</span><span class="n">sh</span> 
<span class="c1"># 注意执行权限</span>
</pre></div>
</div>
<ul class="simple">
<li><p>再次提交为新的镜像</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">commit</span>  <span class="mi">5</span><span class="n">b8161fda2a9</span> <span class="n">centos6</span><span class="o">-</span><span class="n">httpd</span>
</pre></div>
</div>
<ul class="simple">
<li><p>启动镜像，做好端口映射。并在浏览器中测试访问</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">p</span> <span class="mi">1222</span><span class="p">:</span><span class="mi">22</span> <span class="o">-</span><span class="n">p</span> <span class="mi">80</span><span class="p">:</span><span class="mi">80</span>  <span class="n">centos6</span><span class="o">-</span><span class="n">httpd</span> <span class="o">/</span><span class="n">init</span><span class="o">.</span><span class="n">sh</span> 
</pre></div>
</div>
</li>
</ol>
</section>
<section id="dockerfiledocker">
<h1>Dockerfile自动构建docker镜像<a class="headerlink" href="#dockerfiledocker" title="永久链接至标题">¶</a></h1>
<ul class="simple">
<li><p>官方构建dockerffile文件参考:https://github.com/CentOS/CentOS-Dockerfiles</p></li>
</ul>
<ol>
<li><p>Dockerfile指令集</p>
<ul class="simple">
<li><p>dockerfile主要组成部分：</p>
<ul>
<li><p>基础镜像信息 FROM centos:6.8</p></li>
<li><p>制作镜像操作指令RUN yum insatll openssh-server -y</p></li>
<li><p>容器启动时执行指令 CMD [”/bin/bash”]</p></li>
</ul>
</li>
<li><p>dockerfile常用指令：</p>
<ul>
<li><p>FROM 这个镜像的妈妈是谁？（指定基础镜像）</p></li>
<li><p>MAINTAINER 告诉别人，谁负责养它？（指定维护者信息，可以没有）</p></li>
<li><p>RUN 你想让它干啥（在命令前面加上RUN即可）</p></li>
<li><p>ADD 给它点创业资金（COPY文件，会自动解压）</p></li>
<li><p>WORKDIR 我是cd,今天刚化了妆（设置当前工作目录）</p></li>
<li><p>VOLUME 给它一个存放行李的地方（设置卷，挂载主机目录）</p></li>
<li><p>EXPOSE 它要打开的门是啥（指定对外的端口）</p></li>
<li><p>CMD 奔跑吧，兄弟！（指定容器启动后的要干的事情）</p></li>
</ul>
</li>
<li><p>dockerfile其他指令：</p>
<ul>
<li><p>COPY 复制文件</p></li>
<li><p>ENV  环境变量</p></li>
<li><p>ENTRYPOINT  容器启动后执行的命令</p></li>
</ul>
</li>
</ul>
</li>
<li><p>创建一个Dockerfile</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 创建目录</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@docker01</span> <span class="n">base</span><span class="p">]</span><span class="c1"># cd /opt/base</span>
<span class="c1"># 创建Dcokerfile文件，注意大小写</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@docker01</span> <span class="n">base</span><span class="p">]</span><span class="c1"># vim Dockerfile</span>
<span class="n">FROM</span> <span class="n">centos</span><span class="p">:</span><span class="mf">6.8</span>
<span class="n">RUN</span> <span class="n">yum</span> <span class="n">install</span> <span class="n">openssh</span><span class="o">-</span><span class="n">server</span> <span class="o">-</span><span class="n">y</span> 
<span class="n">RUN</span> <span class="n">echo</span> <span class="s2">&quot;root:123456&quot;</span> <span class="o">|</span><span class="n">chpasswd</span>
<span class="n">RUN</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">sshd</span> <span class="n">start</span> 
<span class="n">CMD</span> <span class="p">[</span><span class="s2">&quot;/usr/sbin/sshd&quot;</span><span class="p">,</span><span class="s2">&quot;-D&quot;</span><span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li><p>构建docker镜像</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">image</span> <span class="n">build</span>  <span class="o">-</span><span class="n">t</span> <span class="n">centos6</span><span class="o">.</span><span class="mi">8</span><span class="o">-</span><span class="n">ssh</span> <span class="o">.</span> 
<span class="o">-</span><span class="n">t</span> <span class="n">为镜像标签打标签</span>  <span class="o">.</span> <span class="n">表示当前路径</span>
</pre></div>
</div>
<ul class="simple">
<li><p>使用自构建的镜像启动</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span>  <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">p</span> <span class="mi">2022</span><span class="p">:</span><span class="mi">22</span> <span class="n">centos6</span><span class="o">.</span><span class="mi">8</span><span class="o">-</span><span class="n">ssh</span><span class="o">-</span><span class="n">b</span> 
</pre></div>
</div>
</li>
<li><p>使用Dcokerfile安装kodexplorer</p>
<ul class="simple">
<li><p>Dockerfile文件内容</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>FROM centos:6.8
RUN yum install wget unzip php php-gd php-mbstring -y &amp;&amp; yum clean all
# 设置工作目录，之后的操作都在这个目录中
WORKDIR /var/www/html/
RUN wget -c http://static.kodcloud.com/update/download/kodexplorer4.25.zip
RUN unzip kodexplorer4.25.zip &amp;&amp; rm -f kodexplorer4.25.zip
RUN chown -R apache.apache .
CMD [&quot;/usr/sbin/apachectl&quot;,&quot;-D&quot;,&quot;FOREGROUND&quot;]
更多的Dockerfile可以参考官方方法。
</pre></div>
</div>
</li>
</ol>
</section>
<section id="id6">
<h1>Docker中的镜像分层<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h1>
<ul class="simple">
<li><p>参考文档：http://www.maiziedu.com/wiki/cloud/dockerimage</p></li>
<li><p>Docker 支持通过扩展现有镜像，创建新的镜像。实际上，Docker Hub 中 99% 的镜像都是通过在 base 镜像中安装和配置需要的软件构建出来的。</p></li>
<li><p>新镜像是从 base 镜像一层一层叠加生成的。每安装一个软件，就在现有镜像的基础上增加一层。</p></li>
</ul>
<ol class="simple">
<li><p>Docker 镜像为什么分层</p>
<ul class="simple">
<li><p>镜像分层最大的一个好处就是共享资源。</p></li>
<li><p>比如说有多个镜像都从相同的 base 镜像构建而来，那么 Docker Host 只需在磁盘上保存一份 base 镜像；同时内存中也只需加载一份 base 镜像，就可以为所有容器服务了。而且镜像的每一层都可以被共享。</p></li>
<li><p>如果多个容器共享一份基础镜像，当某个容器修改了基础镜像的内容，比如 /etc 下的文件，这时其他容器的 /etc 是不会被修改的，修改只会被限制在单个容器内。这就是容器 Copy-on-Write 特性。</p></li>
</ul>
</li>
<li><p>可写的容器层</p>
<ul class="simple">
<li><p>当容器启动时，一个新的可写层被加载到镜像的顶部。这一层通常被称作“容器层”，“容器层”之下的都叫“镜像层”。</p></li>
<li><p>所有对容器的改动 - 无论添加、删除、还是修改文件都只会发生在容器层中。只有容器层是可写的，容器层下面的所有镜像层都是只读的。</p></li>
</ul>
</li>
<li><p>容器层的细节说明</p>
<ul class="simple">
<li><p>镜像层数量可能会很多，所有镜像层会联合在一起组成一个统一的文件系统。如果不同层中有一个相同路径的文件，比如 /a，上层的 /a 会覆盖下层的 /a，也就是说用户只能访问到上层中的文件 /a。在容器层中，用户看到的是一个叠加之后的文件系统。</p></li>
<li><p>文件操作说明</p>
<ul>
<li><p>添加文件：在容器中创建文件时，新文件被添加到容器层中。</p></li>
<li><p>读取文件：在容器中读取某个文件时，Docker 会从上往下依次在各镜像层中查找此文件。一旦找到，立即将其复制到容器层，然后打开并读入内存。</p></li>
<li><p>修改文件：在容器中修改已存在的文件时，Docker 会从上往下依次在各镜像层中查找此文件。一旦找到，立即将其复制到容器层，然后修改之。</p></li>
<li><p>删除文件：在容器中删除文件时，Docker 也是从上往下依次在镜像层中查找此文件。找到后，会在容器层中记录下此删除操作。（只是记录删除操作）</p></li>
<li><p>只有当需要修改时才复制一份数据，这种特性被称作 Copy-on-Write。可见，容器层保存的是镜像变化的部分，不会对镜像本身进行任何修改。</p></li>
<li><p>这样就解释了我们前面提出的问题：容器层记录对镜像的修改，所有镜像层都是只读的，不会被容器修改，所以镜像可以被多个容器共享。</p></li>
</ul>
</li>
</ul>
</li>
</ol>
</section>
<section id="dockerzabbix-server">
<h1>使用docker运行zabbix-server<a class="headerlink" href="#dockerzabbix-server" title="永久链接至标题">¶</a></h1>
<ol>
<li><p>容器间的互联</p>
<ul class="simple">
<li><p>在运行zabbix之前务必要了解容器间互联的方法</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 创建一个nginx容器</span>
<span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">p</span> <span class="mi">80</span><span class="p">:</span><span class="mi">80</span> <span class="n">nginx</span>
<span class="c1"># 创建容器，做link，并进入容器中</span>
<span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">it</span> <span class="o">--</span><span class="n">link</span> <span class="n">quirky_brown</span><span class="p">:</span><span class="n">web01</span> <span class="n">centos</span><span class="o">-</span><span class="n">ssh</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span>
<span class="c1"># 在容器中访问nginx容器可以ping通</span>
<span class="n">ping</span> <span class="n">web01</span>
</pre></div>
</div>
<ul class="simple">
<li><p>命令执行过程</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 启动apache容器</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@docker01</span> <span class="o">~</span><span class="p">]</span><span class="c1"># docker run -d httpd:2.4  </span>
<span class="mi">3</span><span class="n">f1f7fc554720424327286bd2b04aeab1b084a3fb011a785b0deab6a34e56955</span>
<span class="o">^</span><span class="p">[[</span><span class="n">A</span><span class="p">[</span><span class="n">root</span><span class="nd">@docker01</span> <span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
<span class="n">CONTAINER</span> <span class="n">ID</span>        <span class="n">IMAGE</span>               <span class="n">COMMAND</span>              <span class="n">CREATED</span>             <span class="n">STATUS</span>              <span class="n">PORTS</span>               <span class="n">NAMES</span>
<span class="mi">3</span><span class="n">f1f7fc55472</span>        <span class="n">httpd</span><span class="p">:</span><span class="mf">2.4</span><span class="s2">&quot;httpd-foreground&quot;</span><span class="mi">6</span> <span class="n">seconds</span> <span class="n">ago</span>       <span class="n">Up</span> <span class="mi">5</span> <span class="n">seconds</span>        <span class="mi">80</span><span class="o">/</span><span class="n">tcp</span>              <span class="n">determined_clarke</span>
<span class="c1"># 拉取一个busybox 镜像</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@docker01</span> <span class="o">~</span><span class="p">]</span><span class="c1"># docker pull busybox </span>
<span class="c1"># 启动容器</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@docker01</span> <span class="o">~</span><span class="p">]</span><span class="c1"># docker run -it  --link determined_clarke:web busybox:latest   /bin/sh </span>
<span class="o">/</span> <span class="c1"># </span>
<span class="c1"># 使用新的容器访问最初的web容器</span>
<span class="o">/</span> <span class="c1"># ping web </span>
<span class="n">PING</span> <span class="n">web</span> <span class="p">(</span><span class="mf">172.17</span><span class="o">.</span><span class="mf">0.2</span><span class="p">):</span> <span class="mi">56</span> <span class="n">data</span> <span class="nb">bytes</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="mf">172.17</span><span class="o">.</span><span class="mf">0.2</span><span class="p">:</span> <span class="n">seq</span><span class="o">=</span><span class="mi">0</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.058</span> <span class="n">ms</span>
<span class="o">^</span><span class="n">C</span>
<span class="o">---</span> <span class="n">web</span> <span class="n">ping</span> <span class="n">statistics</span> <span class="o">---</span>
<span class="mi">1</span> <span class="n">packets</span> <span class="n">transmitted</span><span class="p">,</span> <span class="mi">1</span> <span class="n">packets</span> <span class="n">received</span><span class="p">,</span> <span class="mi">0</span><span class="o">%</span> <span class="n">packet</span> <span class="n">loss</span>
<span class="nb">round</span><span class="o">-</span><span class="n">trip</span> <span class="nb">min</span><span class="o">/</span><span class="n">avg</span><span class="o">/</span><span class="nb">max</span> <span class="o">=</span> <span class="mf">0.058</span><span class="o">/</span><span class="mf">0.058</span><span class="o">/</span><span class="mf">0.058</span> <span class="n">ms</span>
</pre></div>
</div>
</li>
<li><p>启动zabbix容器</p>
<ul class="simple">
<li><p>启动一个mysql的容器</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">name</span> <span class="n">mysql</span><span class="o">-</span><span class="n">server</span> <span class="o">-</span><span class="n">t</span> \
	  <span class="o">-</span><span class="n">e</span> <span class="n">MYSQL_DATABASE</span><span class="o">=</span><span class="s2">&quot;zabbix&quot;</span> \
	  <span class="o">-</span><span class="n">e</span> <span class="n">MYSQL_USER</span><span class="o">=</span><span class="s2">&quot;zabbix&quot;</span> \
	  <span class="o">-</span><span class="n">e</span> <span class="n">MYSQL_PASSWORD</span><span class="o">=</span><span class="s2">&quot;zabbix_pwd&quot;</span> \
	  <span class="o">-</span><span class="n">e</span> <span class="n">MYSQL_ROOT_PASSWORD</span><span class="o">=</span><span class="s2">&quot;root_pwd&quot;</span> \
	  <span class="o">-</span><span class="n">d</span> <span class="n">mysql</span><span class="p">:</span><span class="mf">5.7</span> \
	  <span class="o">--</span><span class="n">character</span><span class="o">-</span><span class="nb">set</span><span class="o">-</span><span class="n">server</span><span class="o">=</span><span class="n">utf8</span> <span class="o">--</span><span class="n">collation</span><span class="o">-</span><span class="n">server</span><span class="o">=</span><span class="n">utf8_bin</span>
</pre></div>
</div>
<ul class="simple">
<li><p>启动java-gateway容器监控java服务</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">name</span> <span class="n">zabbix</span><span class="o">-</span><span class="n">java</span><span class="o">-</span><span class="n">gateway</span> <span class="o">-</span><span class="n">t</span> \
      <span class="o">-</span><span class="n">d</span> <span class="n">zabbix</span><span class="o">/</span><span class="n">zabbix</span><span class="o">-</span><span class="n">java</span><span class="o">-</span><span class="n">gateway</span><span class="p">:</span><span class="n">latest</span>
</pre></div>
</div>
<ul class="simple">
<li><p>启动zabbix-mysql容器使用link连接mysql与java-gateway。</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">name</span> <span class="n">zabbix</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">mysql</span> <span class="o">-</span><span class="n">t</span> \
      <span class="o">-</span><span class="n">e</span> <span class="n">DB_SERVER_HOST</span><span class="o">=</span><span class="s2">&quot;mysql-server&quot;</span> \
      <span class="o">-</span><span class="n">e</span> <span class="n">MYSQL_DATABASE</span><span class="o">=</span><span class="s2">&quot;zabbix&quot;</span> \
      <span class="o">-</span><span class="n">e</span> <span class="n">MYSQL_USER</span><span class="o">=</span><span class="s2">&quot;zabbix&quot;</span> \
      <span class="o">-</span><span class="n">e</span> <span class="n">MYSQL_PASSWORD</span><span class="o">=</span><span class="s2">&quot;zabbix_pwd&quot;</span> \
      <span class="o">-</span><span class="n">e</span> <span class="n">MYSQL_ROOT_PASSWORD</span><span class="o">=</span><span class="s2">&quot;root_pwd&quot;</span> \
      <span class="o">-</span><span class="n">e</span> <span class="n">ZBX_JAVAGATEWAY</span><span class="o">=</span><span class="s2">&quot;zabbix-java-gateway&quot;</span> \
      <span class="o">--</span><span class="n">link</span> <span class="n">mysql</span><span class="o">-</span><span class="n">server</span><span class="p">:</span><span class="n">mysql</span> \
      <span class="o">--</span><span class="n">link</span> <span class="n">zabbix</span><span class="o">-</span><span class="n">java</span><span class="o">-</span><span class="n">gateway</span><span class="p">:</span><span class="n">zabbix</span><span class="o">-</span><span class="n">java</span><span class="o">-</span><span class="n">gateway</span> \
      <span class="o">-</span><span class="n">p</span> <span class="mi">10051</span><span class="p">:</span><span class="mi">10051</span> \
      <span class="o">-</span><span class="n">d</span> <span class="n">zabbix</span><span class="o">/</span><span class="n">zabbix</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">mysql</span><span class="p">:</span><span class="n">latest</span>
</pre></div>
</div>
<ul class="simple">
<li><p>启动zabbix web显示，使用link连接zabbix-mysql与mysql。</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">name</span> <span class="n">zabbix</span><span class="o">-</span><span class="n">web</span><span class="o">-</span><span class="n">nginx</span><span class="o">-</span><span class="n">mysql</span> <span class="o">-</span><span class="n">t</span> \
      <span class="o">-</span><span class="n">e</span> <span class="n">DB_SERVER_HOST</span><span class="o">=</span><span class="s2">&quot;mysql-server&quot;</span> \
      <span class="o">-</span><span class="n">e</span> <span class="n">MYSQL_DATABASE</span><span class="o">=</span><span class="s2">&quot;zabbix&quot;</span> \
      <span class="o">-</span><span class="n">e</span> <span class="n">MYSQL_USER</span><span class="o">=</span><span class="s2">&quot;zabbix&quot;</span> \
      <span class="o">-</span><span class="n">e</span> <span class="n">MYSQL_PASSWORD</span><span class="o">=</span><span class="s2">&quot;zabbix_pwd&quot;</span> \
      <span class="o">-</span><span class="n">e</span> <span class="n">MYSQL_ROOT_PASSWORD</span><span class="o">=</span><span class="s2">&quot;root_pwd&quot;</span> \
      <span class="o">--</span><span class="n">link</span> <span class="n">mysql</span><span class="o">-</span><span class="n">server</span><span class="p">:</span><span class="n">mysql</span> \
      <span class="o">--</span><span class="n">link</span> <span class="n">zabbix</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">mysql</span><span class="p">:</span><span class="n">zabbix</span><span class="o">-</span><span class="n">server</span> \
      <span class="o">-</span><span class="n">p</span> <span class="mi">80</span><span class="p">:</span><span class="mi">80</span> \
      <span class="o">-</span><span class="n">d</span> <span class="n">zabbix</span><span class="o">/</span><span class="n">zabbix</span><span class="o">-</span><span class="n">web</span><span class="o">-</span><span class="n">nginx</span><span class="o">-</span><span class="n">mysql</span><span class="p">:</span><span class="n">latest</span>
</pre></div>
</div>
</li>
<li><p>关于zabbix API</p>
<ul class="simple">
<li><p>关于zabbix API可以参考官方文档：https://www.zabbix.com/documentation/3.4/zh/manual/api</p></li>
<li><p>获取token方法</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 获取token</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@docker02</span> <span class="o">~</span><span class="p">]</span><span class="c1"># curl -s -X POST -H &#39;Content-Type:application/json&#39; -d &#39;</span>
<span class="p">{</span>
<span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
<span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;user.login&quot;</span><span class="p">,</span>
<span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;Admin&quot;</span><span class="p">,</span>
<span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;zabbix&quot;</span>
<span class="p">},</span>
<span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">}</span><span class="s1">&#39; http://10.0.0.100/api_jsonrpc.php</span>
<span class="p">{</span><span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span><span class="s2">&quot;result&quot;</span><span class="p">:</span><span class="s2">&quot;d3be707f9e866ec5d0d1c242292cbebd&quot;</span><span class="p">,</span><span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="docker-registry">
<h1>docker 仓库（registry）<a class="headerlink" href="#docker-registry" title="永久链接至标题">¶</a></h1>
<ol>
<li><p>创建一个普通仓库</p>
<ul class="simple">
<li><p>新建仓库</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">p</span> <span class="mi">5000</span><span class="p">:</span><span class="mi">5000</span> <span class="o">--</span><span class="n">restart</span><span class="o">=</span><span class="n">always</span> <span class="o">--</span><span class="n">name</span> <span class="n">registry</span> <span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">myregistry</span><span class="p">:</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">registry</span>  <span class="n">registry</span>
</pre></div>
</div>
<ul class="simple">
<li><p>修改配置文件，使之支持http</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span>  <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="n">daemon</span><span class="o">.</span><span class="n">json</span> 
<span class="p">{</span>
  <span class="s2">&quot;registry-mirrors&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;https://registry.docker-cn.com&quot;</span><span class="p">],</span>
  <span class="s2">&quot;insecure-registries&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;10.0.0.100:5000&quot;</span><span class="p">]</span>
<span class="p">}</span>
<span class="n">重启docker让修改生效</span>
<span class="n">systemctl</span> <span class="n">restart</span>  <span class="n">docker</span><span class="o">.</span><span class="n">service</span>
</pre></div>
</div>
<ul class="simple">
<li><p>修改镜像标签</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">tag</span>  <span class="n">busybox</span><span class="p">:</span><span class="n">latest</span>  <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.100</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span><span class="n">clsn</span><span class="o">/</span><span class="n">busybox</span><span class="p">:</span><span class="mf">1.0</span>
</pre></div>
</div>
<ul class="simple">
<li><p>将新打标签的镜像上传镜像到仓库</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">push</span>   <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.100</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span><span class="n">clsn</span><span class="o">/</span><span class="n">busybox</span>
</pre></div>
</div>
</li>
<li><p>带basic认证的仓库</p>
<ul class="simple">
<li><p>安装加密工具</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">yum</span> <span class="n">install</span> <span class="n">httpd</span><span class="o">-</span><span class="n">tools</span>  <span class="o">-</span><span class="n">y</span>
</pre></div>
</div>
<ul class="simple">
<li><p>设置认证密码</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">registry</span><span class="o">-</span><span class="n">var</span><span class="o">/</span><span class="n">auth</span><span class="o">/</span> <span class="o">-</span><span class="n">p</span>
<span class="n">htpasswd</span> \<span class="o">-</span><span class="n">Bbn</span> <span class="n">clsn</span> <span class="mi">123456</span>  <span class="o">&gt;</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">registry</span><span class="o">-</span><span class="n">var</span><span class="o">/</span><span class="n">auth</span><span class="o">/</span><span class="n">htpasswd</span>
</pre></div>
</div>
<ul class="simple">
<li><p>启动容器，在启动时传入认证参数</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">p</span> <span class="mi">5000</span><span class="p">:</span><span class="mi">5000</span> <span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">registry</span><span class="o">-</span><span class="n">var</span><span class="o">/</span><span class="n">auth</span><span class="o">/</span><span class="p">:</span><span class="o">/</span><span class="n">auth</span><span class="o">/</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;REGISTRY_AUTH=htpasswd&quot;</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;REGISTRY_AUTH_HTPASSWD_REALM=Registry Realm&quot;</span> <span class="o">-</span><span class="n">e</span> <span class="n">REGISTRY_AUTH_HTPASSWD_PATH</span><span class="o">=/</span><span class="n">auth</span><span class="o">/</span><span class="n">htpasswd</span> <span class="n">registry</span>
</pre></div>
</div>
<ul class="simple">
<li><p>使用验证用户测试</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 登陆用户</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@docker01</span> <span class="o">~</span><span class="p">]</span><span class="c1"># docker login 10.0.0.100:5000 </span>
<span class="n">Username</span><span class="p">:</span> <span class="n">clsn</span>  
<span class="n">Password</span><span class="p">:</span> <span class="mi">123456</span>
<span class="n">Login</span> <span class="n">Succeeded</span>
<span class="c1"># 推送镜像到仓库</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@docker01</span> <span class="o">~</span><span class="p">]</span><span class="c1"># docker push 10.0.0.100:5000/clsn/busybox </span>
<span class="n">The</span> <span class="n">push</span> <span class="n">refers</span> <span class="n">to</span> <span class="n">repository</span> <span class="p">[</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.100</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span><span class="n">clsn</span><span class="o">/</span><span class="n">busybox</span><span class="p">]</span>
<span class="mi">4</span><span class="n">febd3792a1f</span><span class="p">:</span> <span class="n">Pushed</span> 
<span class="mf">1.0</span><span class="p">:</span> <span class="n">digest</span><span class="p">:</span> <span class="n">sha256</span><span class="p">:</span><span class="mi">4</span><span class="n">cee1979ba0bf7db9fc5d28fb7b798ca69ae95a47c5fecf46327720df4ff352d</span> <span class="n">size</span><span class="p">:</span> <span class="mi">527</span>
<span class="c1">#认证文件的保存位置</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@docker01</span> <span class="o">~</span><span class="p">]</span><span class="c1"># cat .docker/config.json </span>
<span class="p">{</span>
	<span class="s2">&quot;auths&quot;</span><span class="p">:</span> <span class="p">{</span>
		<span class="s2">&quot;10.0.0.100:5000&quot;</span><span class="p">:</span> <span class="p">{</span>
			<span class="s2">&quot;auth&quot;</span><span class="p">:</span> <span class="s2">&quot;Y2xzbjoxMjM0NTY=&quot;</span>
		<span class="p">},</span>
		<span class="s2">&quot;https://index.docker.io/v1/&quot;</span><span class="p">:</span> <span class="p">{</span>
			<span class="s2">&quot;auth&quot;</span><span class="p">:</span> <span class="s2">&quot;Y2xzbjpIenNAMTk5Ng==&quot;</span>
		<span class="p">}</span>
	<span class="p">},</span>
	<span class="s2">&quot;HttpHeaders&quot;</span><span class="p">:</span> <span class="p">{</span>
		<span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;Docker-Client/17.12.0-ce (linux)&quot;</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="docker-compose">
<h1>docker-compose编排工具<a class="headerlink" href="#docker-compose" title="永久链接至标题">¶</a></h1>
<ol>
<li><p>安装docker-compose</p>
<ul class="simple">
<li><p>安装docker-compose</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 下载pip软件</span>
<span class="n">yum</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">python2</span><span class="o">-</span><span class="n">pip</span>
<span class="c1"># 下载 docker-compose</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">docker</span><span class="o">-</span><span class="n">compose</span>
</pre></div>
</div>
<ul class="simple">
<li><p>国内开启pip 下载加速：http://mirrors.aliyun.com/help/pypi</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">~/.</span><span class="n">pip</span><span class="o">/</span>
<span class="n">cat</span> <span class="o">&gt;</span> <span class="o">~/.</span><span class="n">pip</span><span class="o">/</span><span class="n">pip</span><span class="o">.</span><span class="n">conf</span> <span class="o">&lt;&lt;</span><span class="s1">&#39;EOF&#39;</span>
<span class="p">[</span><span class="k">global</span><span class="p">]</span>
<span class="n">index</span><span class="o">-</span><span class="n">url</span> <span class="o">=</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">mirrors</span><span class="o">.</span><span class="n">aliyun</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">pypi</span><span class="o">/</span><span class="n">simple</span><span class="o">/</span>
<span class="p">[</span><span class="n">install</span><span class="p">]</span>
<span class="n">trusted</span><span class="o">-</span><span class="n">host</span><span class="o">=</span><span class="n">mirrors</span><span class="o">.</span><span class="n">aliyun</span><span class="o">.</span><span class="n">com</span>
<span class="n">EOF</span>
</pre></div>
</div>
</li>
<li><p>编排启动镜像</p>
<ul class="simple">
<li><p>创建文件目录</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">my_wordpress</span><span class="o">/</span>
<span class="n">cd</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">my_wordpress</span><span class="o">/</span>
</pre></div>
</div>
<ul class="simple">
<li><p>编写编排文件</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@docker01</span> <span class="n">my_wordpress</span><span class="p">]</span><span class="c1"># vim docker-compose.yml</span>
<span class="n">version</span><span class="p">:</span> <span class="s1">&#39;3&#39;</span>
<span class="n">services</span><span class="p">:</span>
   <span class="n">db</span><span class="p">:</span>
     <span class="n">image</span><span class="p">:</span> <span class="n">mysql</span><span class="p">:</span><span class="mf">5.7</span>
     <span class="n">volumes</span><span class="p">:</span>
       <span class="o">-</span> <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">db_data</span><span class="p">:</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">mysql</span>
     <span class="n">restart</span><span class="p">:</span> <span class="n">always</span>
     <span class="n">environment</span><span class="p">:</span>
       <span class="n">MYSQL_ROOT_PASSWORD</span><span class="p">:</span> <span class="n">somewordpress</span>
       <span class="n">MYSQL_DATABASE</span><span class="p">:</span> <span class="n">wordpress</span>
       <span class="n">MYSQL_USER</span><span class="p">:</span> <span class="n">wordpress</span>
       <span class="n">MYSQL_PASSWORD</span><span class="p">:</span> <span class="n">wordpress</span>
   <span class="n">wordpress</span><span class="p">:</span>
     <span class="n">depends_on</span><span class="p">:</span>
       <span class="o">-</span> <span class="n">db</span>
     <span class="n">image</span><span class="p">:</span> <span class="n">wordpress</span><span class="p">:</span><span class="n">latest</span>
     <span class="n">volumes</span><span class="p">:</span>
       <span class="o">-</span> <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">web_data</span><span class="p">:</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span>
     <span class="n">ports</span><span class="p">:</span> 
       <span class="o">-</span> <span class="s2">&quot;8000:80&quot;</span>
     <span class="n">restart</span><span class="p">:</span> <span class="n">always</span>
     <span class="n">environment</span><span class="p">:</span>
       <span class="n">WORDPRESS_DB_HOST</span><span class="p">:</span> <span class="n">db</span><span class="p">:</span><span class="mi">3306</span>
       <span class="n">WORDPRESS_DB_USER</span><span class="p">:</span> <span class="n">wordpress</span>
       <span class="n">WORDPRESS_DB_PASSWORD</span><span class="p">:</span> <span class="n">wordpress</span>
</pre></div>
</div>
<ul class="simple">
<li><p>启动</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">up</span>
<span class="c1">#启动方法：docker-compose up</span>
<span class="c1">#后台启动方法：docker-compose up -d</span>
</pre></div>
</div>
<ul class="simple">
<li><p>浏览器上访问http://10.0.0.100:8000</p></li>
</ul>
</li>
<li><p>haproxy代理后端docker容器</p>
<ul>
<li><p>修改编排脚本</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="o">.</span><span class="n">yml</span>
<span class="n">version</span><span class="p">:</span> <span class="s1">&#39;3&#39;</span>
<span class="n">services</span><span class="p">:</span>
   <span class="n">db</span><span class="p">:</span>
	 <span class="n">image</span><span class="p">:</span> <span class="n">mysql</span><span class="p">:</span><span class="mf">5.7</span>
	 <span class="n">volumes</span><span class="p">:</span>
	   <span class="o">-</span> <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">db_data</span><span class="p">:</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">mysql</span>
	 <span class="n">restart</span><span class="p">:</span> <span class="n">always</span>
	 <span class="n">environment</span><span class="p">:</span>
	   <span class="n">MYSQL_ROOT_PASSWORD</span><span class="p">:</span> <span class="n">somewordpress</span>
	   <span class="n">MYSQL_DATABASE</span><span class="p">:</span> <span class="n">wordpress</span>
	   <span class="n">MYSQL_USER</span><span class="p">:</span> <span class="n">wordpress</span>
	   <span class="n">MYSQL_PASSWORD</span><span class="p">:</span> <span class="n">wordpress</span>
   <span class="n">wordpress</span><span class="p">:</span>
	 <span class="n">depends_on</span><span class="p">:</span>
	   <span class="o">-</span> <span class="n">db</span>
	 <span class="n">image</span><span class="p">:</span> <span class="n">wordpress</span><span class="p">:</span><span class="n">latest</span>
	 <span class="n">volumes</span><span class="p">:</span>
	   <span class="o">-</span> <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">web_data</span><span class="p">:</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span>
	 <span class="n">ports</span><span class="p">:</span> 
	   <span class="o">-</span> <span class="s2">&quot;80&quot;</span>
	 <span class="n">restart</span><span class="p">:</span> <span class="n">always</span>
	 <span class="n">environment</span><span class="p">:</span>
	   <span class="n">WORDPRESS_DB_HOST</span><span class="p">:</span> <span class="n">db</span><span class="p">:</span><span class="mi">3306</span>
	   <span class="n">WORDPRESS_DB_USER</span><span class="p">:</span> <span class="n">wordpress</span>
	   <span class="n">WORDPRESS_DB_PASSWORD</span><span class="p">:</span> <span class="n">wordpress</span>
</pre></div>
</div>
</li>
<li><p>同时启动两台wordpress</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">scale</span> <span class="n">wordpress</span><span class="o">=</span><span class="mi">2</span>
<span class="n">WARNING</span><span class="p">:</span> <span class="n">The</span> <span class="n">scale</span> <span class="n">command</span> <span class="ow">is</span> <span class="n">deprecated</span><span class="o">.</span> <span class="n">Use</span> <span class="n">the</span> <span class="n">up</span> <span class="n">command</span> <span class="k">with</span> <span class="n">the</span> <span class="o">--</span><span class="n">scale</span> <span class="n">flag</span> <span class="n">instead</span><span class="o">.</span>
<span class="n">Starting</span> <span class="n">mywordpress_wordpress_1</span> <span class="o">...</span> <span class="n">done</span>
<span class="n">Creating</span> <span class="n">mywordpress_wordpress_2</span> <span class="o">...</span> <span class="n">done</span>
</pre></div>
</div>
</li>
<li><p>安装haproxy</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">yum</span> <span class="n">install</span> <span class="n">haproxy</span> <span class="o">-</span><span class="n">y</span>
</pre></div>
</div>
</li>
<li><p>修改haproxy配置文件</p>
<ul class="simple">
<li><p>关于配置文件的详细说明，参考：https://www.cnblogs.com/MacoLee/p/5853413.html</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@docker01</span> <span class="o">~</span><span class="p">]</span><span class="c1">#cp /etc/haproxy/haproxy.cfg{,.bak}</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@docker01</span> <span class="o">~</span><span class="p">]</span><span class="c1"># vim /etc/haproxy/haproxy.cfg</span>
<span class="k">global</span>
    <span class="n">log127</span><span class="o">.</span><span class="mf">0.0</span><span class="o">.</span><span class="mi">1</span> <span class="n">local2</span>
    <span class="n">chroot</span>      <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">haproxy</span>
    <span class="n">pidfile</span>     <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">haproxy</span><span class="o">.</span><span class="n">pid</span>
    <span class="n">maxconn</span>     <span class="mi">4000</span>
    <span class="n">user</span>        <span class="n">haproxy</span>
    <span class="n">group</span>       <span class="n">haproxy</span>
    <span class="n">daemon</span>
    <span class="n">stats</span> <span class="n">socket</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">haproxy</span><span class="o">/</span><span class="n">stats</span> <span class="n">level</span> <span class="n">admin</span>  <span class="c1">#支持命令行控制</span>
<span class="n">defaults</span>
    <span class="n">mode</span>                    <span class="n">http</span>
    <span class="n">log</span>                     <span class="k">global</span>
    <span class="n">option</span>                  <span class="n">httplog</span>
    <span class="n">option</span>                  <span class="n">dontlognull</span>
    <span class="n">option</span> <span class="n">http</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">close</span>
    <span class="n">option</span> <span class="n">forwardfor</span>       <span class="k">except</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">8</span>
    <span class="n">option</span>                  <span class="n">redispatch</span>
    <span class="n">retries</span>                 <span class="mi">3</span>
    <span class="n">timeout</span> <span class="n">http</span><span class="o">-</span><span class="n">request</span>    <span class="mi">10</span><span class="n">s</span>
    <span class="n">timeout</span> <span class="n">queue1m</span>
    <span class="n">timeout</span> <span class="n">connect</span>         <span class="mi">10</span><span class="n">s</span>
    <span class="n">timeout</span> <span class="n">client</span>          <span class="mi">1</span><span class="n">m</span>
    <span class="n">timeout</span> <span class="n">server</span>          <span class="mi">1</span><span class="n">m</span>
    <span class="n">timeout</span> <span class="n">http</span><span class="o">-</span><span class="n">keep</span><span class="o">-</span><span class="n">alive</span> <span class="mi">10</span><span class="n">s</span>
    <span class="n">timeout</span> <span class="n">check</span>           <span class="mi">10</span><span class="n">s</span>
    <span class="n">maxconn</span>                 <span class="mi">3000</span>
<span class="n">listen</span> <span class="n">stats</span>
    <span class="n">mode</span> <span class="n">http</span>
    <span class="n">bind</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="p">:</span><span class="mi">8888</span>
    <span class="n">stats</span> <span class="n">enable</span>
    <span class="n">stats</span> <span class="n">uri</span>     <span class="o">/</span><span class="n">haproxy</span><span class="o">-</span><span class="n">status</span> 
    <span class="n">stats</span> <span class="n">auth</span>    <span class="n">admin</span><span class="p">:</span><span class="mi">123456</span>
<span class="n">frontend</span> <span class="n">frontend_www_example_com</span>
    <span class="n">bind</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.100</span><span class="p">:</span><span class="mi">8000</span>
    <span class="n">mode</span> <span class="n">http</span>
    <span class="n">option</span> <span class="n">httplog</span>
    <span class="n">log</span> <span class="k">global</span>
    <span class="n">default_backend</span> <span class="n">backend_www_example_com</span>
<span class="n">backend</span> <span class="n">backend_www_example_com</span>
    <span class="n">option</span> <span class="n">forwardfor</span> <span class="n">header</span> <span class="n">X</span><span class="o">-</span><span class="n">REAL</span><span class="o">-</span><span class="n">IP</span>
    <span class="n">option</span> <span class="n">httpchk</span> <span class="n">HEAD</span> <span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.0</span>
    <span class="n">balance</span> <span class="n">roundrobin</span>
    <span class="n">server</span> <span class="n">web</span><span class="o">-</span><span class="n">node1</span>  <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.100</span><span class="p">:</span><span class="mi">32768</span> <span class="n">check</span> <span class="n">inter</span> <span class="mi">2000</span> <span class="n">rise</span> <span class="mi">30</span> <span class="n">fall</span> <span class="mi">15</span>
    <span class="n">server</span> <span class="n">web</span><span class="o">-</span><span class="n">node2</span>  <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.100</span><span class="p">:</span><span class="mi">32769</span> <span class="n">check</span> <span class="n">inter</span> <span class="mi">2000</span> <span class="n">rise</span> <span class="mi">30</span> <span class="n">fall</span> <span class="mi">15</span>
</pre></div>
</div>
</li>
<li><p>启动haproxy</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">systemctl</span> <span class="n">start</span> <span class="n">haproxy</span>
<span class="n">systemctl</span> <span class="n">enable</span> <span class="n">haproxy</span>
</pre></div>
</div>
</li>
<li><p>使用浏览器访问hapeoxy监听的8000端口可以看到负载的情况</p></li>
<li><p>使用浏览器访问 http://10.0.0.100:8888/haproxy-status</p></li>
</ul>
</li>
<li><p>安装socat 直接操作socket控制haproxy</p>
<ul class="simple">
<li><p>安装软件</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">yum</span> <span class="n">install</span> <span class="n">socat</span><span class="o">.</span><span class="n">x86</span>\<span class="n">_64</span> <span class="o">-</span><span class="n">y</span>
</pre></div>
</div>
<ul class="simple">
<li><p>查看帮助</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s2">&quot;help&quot;</span><span class="o">|</span><span class="n">socat</span> <span class="n">stdio</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">haproxy</span><span class="o">/</span><span class="n">stats</span>
</pre></div>
</div>
<ul class="simple">
<li><p>下线后端节点</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s2">&quot;disable server backend_www_example_com/web-node2&quot;</span><span class="o">|</span><span class="n">socat</span> <span class="n">stdio</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">haproxy</span><span class="o">/</span><span class="n">stats</span>
</pre></div>
</div>
<ul class="simple">
<li><p>上线后端节点</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s2">&quot;enable server backend_www_example_com/web-node3&quot;</span><span class="o">|</span><span class="n">socat</span> <span class="n">stdio</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">haproxy</span><span class="o">/</span><span class="n">stats</span>
</pre></div>
</div>
<ul class="simple">
<li><p>编写php测试页，放到/data/web_data下，在浏览器中访问可以查看当前的节点</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>vim check.php
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;PHP测试&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;?php  echo &#39;&lt;p&gt;Hello World &lt;/p&gt;&#39;; ?&gt;
        &lt;?php  echo &quot;访问的服务器地址是:&quot;.&quot;&lt;fontcolor=red&gt;&quot;.$_SERVER[&#39;SERVER_ADDR&#39;].&quot;&lt;/font&gt;&quot;.&quot;&lt;br&gt;&quot;;
        echo&quot;访问的服务器域名是:&quot;.&quot;&lt;fontcolor=red&gt;&quot;.$_SERVER[&#39;SERVER_NAME&#39;].&quot;&lt;/font&gt;&quot;.&quot;&lt;br&gt;&quot;;
        ?&gt;
    &lt;/body&gt;
&lt;/html&gt;
</pre></div>
</div>
</li>
</ol>
</section>
<section id="id7">
<h1>重启docker服务，容器全部退出的解决办法<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h1>
<ol>
<li><p>在启动是指定自动重启</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span>  <span class="o">--</span><span class="n">restart</span><span class="o">=</span><span class="n">always</span>
</pre></div>
</div>
</li>
<li><p>修改docker默认配置文件</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 添加上下面这行</span>
<span class="s2">&quot;live-restore&quot;</span><span class="p">:</span> <span class="n">true</span>
</pre></div>
</div>
<ul class="simple">
<li><p>docker server配置文件/etc/docker/daemon.json参考</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@docker02</span> <span class="o">~</span><span class="p">]</span><span class="c1"># cat  /etc/docker/daemon.json </span>
<span class="p">{</span>
  <span class="s2">&quot;registry-mirrors&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;https://registry.docker-cn.com&quot;</span><span class="p">],</span>
  <span class="s2">&quot;graph&quot;</span><span class="p">:</span> <span class="s2">&quot;/opt/mydocker&quot;</span><span class="p">,</span> <span class="c1"># 修改数据的存放目录到/opt/mydocker/，原/var/lib/docker/</span>
  <span class="s2">&quot;insecure-registries&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;10.0.0.100:5000&quot;</span><span class="p">],</span>
  <span class="s2">&quot;live-restore&quot;</span><span class="p">:</span> <span class="n">true</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>重启生效，只对在此之后启动的容器生效</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">systemctl</span> <span class="n">restart</span>  <span class="n">docker</span><span class="o">.</span><span class="n">service</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="id8">
<h1>Docker网络类型<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h1>
<ol>
<li><p>docker的网络类型</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>|None|不为容器配置任何网络功能，没有网络 --net=none|
|Container|与另一个运行中的容器共享Network Namespace，--net=container:containerID|
|Host|与主机共享Network Namespace，--net=host|
|Bridge|Docker设计的NAT网络模型（默认类型）|
</pre></div>
</div>
<ul class="simple">
<li><p>Bridge默认docker网络隔离基于网络命名空间，在物理机上创建docker容器时会为每一个docker容器分配网络命名空间，并且把容器IP桥接到物理机的虚拟网桥上。</p></li>
</ul>
</li>
<li><p>不为容器配置网络功能</p>
<ul class="simple">
<li><p>此模式下创建容器是不会为容器配置任何网络参数的，如：容器网卡、IP、通信路由等，全部需要自己去配置。</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span>  <span class="o">-</span><span class="n">it</span> <span class="o">--</span><span class="n">network</span> <span class="n">none</span> <span class="n">busybox</span><span class="p">:</span><span class="n">latest</span>  <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sh</span>
<span class="o">/</span> <span class="c1"># ip a</span>
<span class="mi">1</span><span class="p">:</span> <span class="n">lo</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">LOOPBACK</span><span class="p">,</span><span class="n">UP</span><span class="p">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">65536</span> <span class="n">qdisc</span> <span class="n">noqueue</span> 
	<span class="n">link</span><span class="o">/</span><span class="n">loopback</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="n">brd</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
	<span class="n">inet</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="o">/</span><span class="mi">8</span> <span class="n">scope</span> <span class="n">host</span> <span class="n">lo</span>
	   <span class="n">valid_lft</span> <span class="n">forever</span> <span class="n">preferred_lft</span> <span class="n">forever</span>
</pre></div>
</div>
</li>
<li><p>与其他容器共享网络配置(Container）</p>
<ul class="simple">
<li><p>此模式和host模式很类似，只是此模式创建容器共享的是其他容器的IP和端口而不是物理机，此模式容器自身是不会配置网络和端口，创建此模式容器进去后，你会发现里边的IP是你所指定的那个容器IP并且端口也是共享的，而且其它还是互相隔离的，如进程等。</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span>  <span class="o">-</span><span class="n">it</span> <span class="o">--</span><span class="n">network</span> <span class="n">container</span><span class="p">:</span><span class="n">mywordpress_db_1</span>  <span class="n">busybox</span><span class="p">:</span><span class="n">latest</span>  <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sh</span>
<span class="o">/</span> <span class="c1"># ip a</span>
<span class="mi">1</span><span class="p">:</span> <span class="n">lo</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">LOOPBACK</span><span class="p">,</span><span class="n">UP</span><span class="p">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">65536</span> <span class="n">qdisc</span> <span class="n">noqueue</span> 
	<span class="n">link</span><span class="o">/</span><span class="n">loopback</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="n">brd</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
	<span class="n">inet</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="o">/</span><span class="mi">8</span> <span class="n">scope</span> <span class="n">host</span> <span class="n">lo</span>
	   <span class="n">valid_lft</span> <span class="n">forever</span> <span class="n">preferred_lft</span> <span class="n">forever</span>
<span class="mi">105</span><span class="p">:</span> <span class="n">eth0</span><span class="nd">@if106</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="p">,</span><span class="n">UP</span><span class="p">,</span><span class="n">LOWER_UP</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="n">DOWN</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">1500</span> <span class="n">qdisc</span> <span class="n">noqueue</span> 
	<span class="n">link</span><span class="o">/</span><span class="n">ether</span> <span class="mi">02</span><span class="p">:</span><span class="mi">42</span><span class="p">:</span><span class="n">ac</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">03</span> <span class="n">brd</span> <span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span>
	<span class="n">inet</span> <span class="mf">172.18</span><span class="o">.</span><span class="mf">0.3</span><span class="o">/</span><span class="mi">16</span> <span class="n">brd</span> <span class="mf">172.18</span><span class="o">.</span><span class="mf">255.255</span> <span class="n">scope</span> <span class="k">global</span> <span class="n">eth0</span>
	   <span class="n">valid_lft</span> <span class="n">forever</span> <span class="n">preferred_lft</span> <span class="n">forever</span>
</pre></div>
</div>
</li>
<li><p>使用宿主机网络</p>
<ul class="simple">
<li><p>此模式创建的容器没有自己独立的网络命名空间，是和物理机共享一个Network Namespace，并且共享物理机的所有端口与IP，并且这个模式认为是不安全的。</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span>  <span class="o">-</span><span class="n">it</span> <span class="o">--</span><span class="n">network</span> <span class="n">host</span>  <span class="n">busybox</span><span class="p">:</span><span class="n">latest</span>  <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sh</span>
</pre></div>
</div>
</li>
<li><p>查看网络列表</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">network</span> <span class="nb">list</span>
<span class="n">NETWORK</span> <span class="n">ID</span>          <span class="n">NAME</span>                  <span class="n">DRIVER</span>              <span class="n">SCOPE</span>
<span class="n">b15e8a720d3b</span>        <span class="n">bridge</span>                <span class="n">bridge</span>              <span class="n">local</span>
<span class="mi">345</span><span class="n">d65b4c2a0</span>        <span class="n">host</span>                  <span class="n">host</span>                <span class="n">local</span>
<span class="n">bc5e2a32bb55</span>        <span class="n">mywordpress_default</span>   <span class="n">bridge</span>              <span class="n">local</span>
<span class="n">ebf76eea91bb</span>        <span class="n">none</span>                  <span class="n">null</span>                <span class="n">local</span>
</pre></div>
</div>
</li>
<li><p>用PIPEWORK为docker容器配置独立IP</p>
<ul class="simple">
<li><p>参考文档：http://blog.csdn.net/design321/article/details/48264825</p></li>
<li><p>官方网站：https://github.com/jpetazzo/pipework</p></li>
<li><p>宿主环境：centos7.2</p></li>
<li><p>安装pipework</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">jpetazzo</span><span class="o">/</span><span class="n">pipework</span><span class="o">/</span><span class="n">archive</span><span class="o">/</span><span class="n">master</span><span class="o">.</span><span class="n">zip</span>
<span class="n">unzip</span> <span class="n">master</span><span class="o">.</span><span class="n">zip</span> 
<span class="n">cp</span> <span class="n">pipework</span><span class="o">-</span><span class="n">master</span><span class="o">/</span><span class="n">pipework</span>  <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span>
<span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">pipework</span>
</pre></div>
</div>
<ul class="simple">
<li><p>配置桥接网卡</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">安装桥接工具</span>
<span class="n">yum</span> <span class="n">install</span> <span class="n">bridge</span><span class="o">-</span><span class="n">utils</span><span class="o">.</span><span class="n">x86</span>\<span class="n">_64</span> <span class="o">-</span><span class="n">y</span>
</pre></div>
</div>
<ul class="simple">
<li><p>修改网卡配置，实现桥接</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 修改eth0配置，让br0实现桥接</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@docker01</span> <span class="o">~</span><span class="p">]</span><span class="c1"># cat /etc/sysconfig/network-scripts/ifcfg-eth0 </span>
<span class="n">TYPE</span><span class="o">=</span><span class="n">Ethernet</span>
<span class="n">BOOTPROTO</span><span class="o">=</span><span class="n">static</span>
<span class="n">NAME</span><span class="o">=</span><span class="n">eth0</span>
<span class="n">DEVICE</span><span class="o">=</span><span class="n">eth0</span>
<span class="n">ONBOOT</span><span class="o">=</span><span class="n">yes</span>
<span class="n">BRIDGE</span><span class="o">=</span><span class="n">br0</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@docker01</span> <span class="o">~</span><span class="p">]</span><span class="c1"># cat /etc/sysconfig/network-scripts/ifcfg-br0 </span>
<span class="n">TYPE</span><span class="o">=</span><span class="n">Bridge</span>
<span class="n">BOOTPROTO</span><span class="o">=</span><span class="n">static</span>
<span class="n">NAME</span><span class="o">=</span><span class="n">br0</span>
<span class="n">DEVICE</span><span class="o">=</span><span class="n">br0</span>
<span class="n">ONBOOT</span><span class="o">=</span><span class="n">yes</span>
<span class="n">IPADDR</span><span class="o">=</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.100</span>
<span class="n">NETMASK</span><span class="o">=</span><span class="mf">255.255</span><span class="o">.</span><span class="mf">255.0</span>
<span class="n">GATEWAY</span><span class="o">=</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.254</span>
<span class="n">DNS1</span><span class="o">=</span><span class="mf">223.5</span><span class="o">.</span><span class="mf">5.5</span>
<span class="c1"># 重启网络</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@docker01</span> <span class="o">~</span><span class="p">]</span><span class="c1"># /etc/init.d/network restart</span>
</pre></div>
</div>
<ul class="simple">
<li><p>运行一个容器镜像测试：</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>pipework br0 \$\(docker run -d -it -p 6880:80 --name  httpd\_pw httpd\) 10.0.0.220/24\@10.0.0.254
</pre></div>
</div>
<ul class="simple">
<li><p>在其他主机上测试端口及连通性</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[root@docker01 ~]# curl 10.0.0.220
&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;
[root@docker01 ~]# ping 10.0.0.220 -c 1
PING 10.0.0.220 (10.0.0.220) 56(84) bytes of data.
64 bytes from 10.0.0.220: icmp_seq=1 ttl=64 time=0.043 ms
</pre></div>
</div>
<ul class="simple">
<li><p>再运行一个容器，设置网路类型为none：</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>pipework br0 $(docker run -d -it --net=none --name test httpd:2.4) 10.0.0.221/24@10.0.0.254
</pre></div>
</div>
<ul class="simple">
<li><p>进行访问测试</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[root@docker01 ~]# curl 10.0.0.221
&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;
</pre></div>
</div>
<ul class="simple">
<li><p>重启容器后需要再次指定：</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pipework</span> <span class="n">br0</span> <span class="n">testduliip</span>  <span class="mf">172.16</span><span class="o">.</span><span class="mf">146.113</span><span class="o">/</span><span class="mi">24</span>\<span class="o">@</span><span class="mf">172.16</span><span class="o">.</span><span class="mf">146.1</span> <span class="n">pipework</span> <span class="n">br0</span> <span class="n">testduliip01</span> <span class="mf">172.16</span><span class="o">.</span><span class="mf">146.112</span><span class="o">/</span><span class="mi">24</span>\<span class="o">@</span><span class="mf">172.16</span><span class="o">.</span><span class="mf">146.1</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Dcoker跨主机通信之overlay可以参考：</p></li>
<li><p>http://www.cnblogs.com/CloudMan6/p/7270551.html</p></li>
</ul>
</li>
<li><p>Docker跨主机通信之macvlan</p>
<ul class="simple">
<li><p>创建网络</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">network</span>  <span class="n">create</span> <span class="o">--</span><span class="n">driver</span> <span class="n">macvlan</span>  <span class="o">--</span><span class="n">subnet</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">24</span> <span class="o">--</span><span class="n">gateway</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">0.254</span> <span class="o">-</span><span class="n">o</span> <span class="n">parent</span><span class="o">=</span><span class="n">eth0</span>  <span class="n">macvlan_1</span>
</pre></div>
</div>
<ul class="simple">
<li><p>设置网卡为混杂模式</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ip</span> <span class="n">link</span> <span class="nb">set</span> <span class="n">eth0</span> <span class="n">promisc</span> <span class="n">on</span>
</pre></div>
</div>
<ul class="simple">
<li><p>创建使用macvlan网络容器</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span>  <span class="o">-</span><span class="n">it</span> <span class="o">--</span><span class="n">network</span> <span class="n">macvlan_1</span>  <span class="o">--</span><span class="n">ip</span><span class="o">=</span><span class="mf">10.1</span><span class="o">.</span><span class="mf">0.222</span> <span class="n">busybox</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sh</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="dockerharbor">
<h1>docker企业级镜像仓库harbor<a class="headerlink" href="#dockerharbor" title="永久链接至标题">¶</a></h1>
<ul>
<li><p>容器管理</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@docker01</span> <span class="n">harbor</span><span class="p">]</span><span class="c1"># pwd</span>
<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">harbor</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@docker01</span> <span class="n">harbor</span><span class="p">]</span><span class="c1"># docker-compose stop</span>
</pre></div>
</div>
</li>
</ul>
<ol>
<li><p>安装docker、docker-compose</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">下载</span> <span class="n">harbor</span>
<span class="n">cd</span> <span class="o">/</span><span class="n">opt</span> <span class="o">&amp;&amp;</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">storage</span><span class="o">.</span><span class="n">googleapis</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">harbor</span><span class="o">-</span><span class="n">releases</span><span class="o">/</span><span class="n">harbor</span><span class="o">-</span><span class="n">offline</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">v1</span><span class="o">.</span><span class="mf">3.0</span><span class="o">.</span><span class="n">tgz</span>
<span class="n">tar</span> <span class="n">xf</span> <span class="n">harbor</span><span class="o">-</span><span class="n">offline</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">v1</span><span class="o">.</span><span class="mf">3.0</span><span class="o">.</span><span class="n">tgz</span>
</pre></div>
</div>
</li>
<li><p>修改主机及web界面密码</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[root@docker01 harbor]# vim harbor.cfg 
	···
	hostname = 10.0.0.100
	harbor_admin_password = Harbor12345
	···
</pre></div>
</div>
</li>
<li><p>执行安装脚本</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@docker01</span> <span class="n">harbor</span><span class="p">]</span><span class="c1"># ./install.sh</span>
<span class="n">浏览器访问</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.11</span>
</pre></div>
</div>
</li>
<li><p>镜像推送到仓库的指定项目</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@docker02</span> <span class="o">~</span><span class="p">]</span><span class="c1"># docker  tag centos:6.8  10.0.0.100/clsn/centos6.8:1.0</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@docker02</span> <span class="o">~</span><span class="p">]</span><span class="c1">#  </span>
<span class="p">[</span><span class="n">root</span><span class="nd">@docker02</span> <span class="o">~</span><span class="p">]</span><span class="c1"># docker images </span>
<span class="n">REPOSITORY</span>                  <span class="n">TAG</span>                 <span class="n">IMAGE</span> <span class="n">ID</span>            <span class="n">CREATED</span>             <span class="n">SIZE</span>
<span class="n">busybox</span>                     <span class="n">latest</span>              <span class="mi">5</span><span class="n">b0d59026729</span>        <span class="mi">8</span> <span class="n">days</span> <span class="n">ago</span>          <span class="mf">1.15</span><span class="n">MB</span>
<span class="mf">10.0</span><span class="o">.</span><span class="mf">0.100</span><span class="o">/</span><span class="n">clsn</span><span class="o">/</span><span class="n">centos6</span><span class="o">.</span><span class="mf">81.06704</span><span class="n">d778b3ba</span>        <span class="mi">2</span> <span class="n">months</span> <span class="n">ago</span>        <span class="mi">195</span><span class="n">MB</span>
<span class="n">centos</span>                      <span class="mf">6.86704</span><span class="n">d778b3ba</span>        <span class="mi">2</span> <span class="n">months</span> <span class="n">ago</span>        <span class="mi">195</span><span class="n">MB</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@docker02</span> <span class="o">~</span><span class="p">]</span><span class="c1"># docker login 10.0.0.100</span>
<span class="n">Username</span><span class="p">:</span> <span class="n">admin</span>
<span class="n">Password</span><span class="p">:</span> 
<span class="n">Login</span> <span class="n">Succeeded</span>
</pre></div>
</div>
</li>
<li><p>推送镜像</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@docker02</span> <span class="o">~</span><span class="p">]</span><span class="c1"># docker push 10.0.0.100/clsn/centos6.8</span>
<span class="n">The</span> <span class="n">push</span> <span class="n">refers</span> <span class="n">to</span> <span class="n">repository</span> <span class="p">[</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.100</span><span class="o">/</span><span class="n">clsn</span><span class="o">/</span><span class="n">centos6</span><span class="o">.</span><span class="mi">8</span><span class="p">]</span>
<span class="n">e00c9229b481</span><span class="p">:</span> <span class="n">Pushing</span>  <span class="mf">13.53</span><span class="n">MB</span><span class="o">/</span><span class="mf">194.5</span><span class="n">MB</span>
</pre></div>
</div>
</li>
<li><p>在web界面里查看</p></li>
</ol>
</section>
<section id="id9">
<h1>使用容器的建议<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h1>
<ol class="simple">
<li><p>不要以拆分方式进行应用程序发布</p></li>
<li><p>不要创建大型镜像</p></li>
<li><p>不要在单个容器中运行多个进程</p></li>
<li><p>不要再镜像内保存凭证，不要依赖IP地址</p></li>
<li><p>以非root用户运行进程</p></li>
<li><p>不要使用“最新”标签</p></li>
<li><p>不要利用运行中的容器创建镜像</p></li>
<li><p>不要使用单层镜像</p></li>
<li><p>不要将数据存放在容器内</p></li>
</ol>
</section>
<section id="id10">
<h1>关于Docker容器的监控<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h1>
<ol class="simple">
<li><p>容器的基本信息</p></li>
<li><p>包括容器的数量、ID、名称、镜像、启动命令、端口等信息</p></li>
<li><p>容器的运行状态</p></li>
<li><p>统计各状态的容器的数量，包括运行中、暂停、停止及异常退出</p></li>
<li><p>容器的用量信息</p></li>
<li><p>统计容器的CPU使用率、内存使用量、块设备I/O使用量、网络使用情况等资源的使用情况</p></li>
</ol>
<p>参考：
<a class="reference external" href="https://mp.weixin.qq.com/s/vhLZ_KUa5kdMYDhURQtGPw"></a></p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Docker" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../DevOps%E8%90%BD%E5%9C%B0%E7%AC%94%E8%AE%B0/index.html" class="btn btn-neutral float-right" title="DevOps落地笔记" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2022, Liulinyuan.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>